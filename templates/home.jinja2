{% extends 'base.jinja2' %}

{% block content %}
<h1>Viewer sessions</h1>

<table border = 1>
    <thead>
        <tr>
            <th>Request ID</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Playing Time</th>
            <th>CDN</th>
            <th>Rebuff</th>
            <th>Average Bits</th>
            <th>Asset Name</th>
        </tr>
    </thead>
    {% for session_id, session in sessions.items() %}
        <tbody>
            <tr>
                <th><a href="{{ url_for('session_function', session_id=session_id) }}">{{ session['streamUrl'].split('=')[1] }}</a></th>
                <td> {{ prettify_date(session['startTimeMs']) }} </td>
                <td> {{ prettify_date(session['startTimeMs'] + session['joinTimeMs'] + session['playTimeMs'] + session['buffTimeMs']) }} </td>
                <td> {{ prettify_time(session['playTimeMs']) }} </td>
                <td> {{ session['cdn'] }} </td>
                <td> {{ round(100 * (session['buffTimeMs'] / (session['playTimeMs'] + session['buffTimeMs'])), 2)|string + ' %' }} </td>
                <td> {{ round(session['avgBitrateKbps'] / 1024, 2)|string + ' Mbps' }} </td>
                <td> {{ session['asset'] }} </td>
            </tr>
        </tbody>
    {% endfor %}
</table>
{% endblock %}